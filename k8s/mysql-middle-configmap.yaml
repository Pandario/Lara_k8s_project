apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-middle-init
data:
  init.sql: |
    -- api_middle initial schema
    CREATE TABLE invoice_relations (
      id INT AUTO_INCREMENT PRIMARY KEY,
      id_first INT,
      id_end  INT,
      invoice_data_first TEXT,
      invoice_data_end TEXT,
      invoice_id_first VARCHAR(100),
      invoice_id_end  VARCHAR(100),
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );

    -- company table (new)
    CREATE TABLE company (
      id INT AUTO_INCREMENT PRIMARY KEY,
      company_id_first VARCHAR(255),
      company_id_end VARCHAR(255),
      company_name VARCHAR(255)
    );
    
    -- logs
    CREATE TABLE api_logs (
      id INT AUTO_INCREMENT PRIMARY KEY,
      level VARCHAR(20),
      message TEXT,
      context JSON,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );